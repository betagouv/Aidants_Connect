{% extends 'layouts/main-habilitation.html' %}
{% load static form_extras %}

{% block title %}
  Aidants Connect — Récapitulatif
{% endblock %}

{% block content %}
  <div class="fr-container">
    {% include 'edito/_titre_formulaire_habilitation.html' %}
    {% include 'layouts/_breadcrumbs.html' %}
    <h2>Récapitulatif de la demande</h2>
    <p class="subtitle">
      Vous retrouverez ici les informations principales saisies dans le formulaire.
      Il est possible de les modifier si besoin.
    </p>
    <h3>Informations générales</h3>
    <div class="form-in-3-cols">
      <div class="fr-grid-row fr-grid-row--gutters">
        <div class="fr-col-12 fr-col-md-6 fr-col-lg-4">
          <div class="shadowed with-button-box">
            <h4 class="h2">Vous êtes :</h4>
            <strong>{{ issuer.get_full_name }}</strong>
            <p>{{ issuer.profession }}</p>
            <a href="mailto:{{ issuer.email }}">{{ issuer.email }}</a>
            <a href="tel:{{ issuer.phone }}">{{ issuer.phone }}</a>
            <div class="button-box">
              <a class="button primary"
                 href="{% url 'habilitation_modify_issuer' issuer_id=issuer.issuer_id %}">Éditer</a>
            </div>
          </div>
        </div>
        <div class="fr-col-12 fr-col-md-6 fr-col-lg-4">
          <div class="shadowed with-button-box">
            <h4 class="h2">Vous faites cette demande pour :</h4>
            <address>
              {{ organisation.address }}<br/>
              {{ organisation.zipcode }}<br/>
              {{ organisation.city }}<br/>
            </address>
            <p>SIRET : {{ organisation.siret }}</p>
            <div class="button-box">
              <a class="button primary"
                 href="{% url 'habilitation_modify_organisation' issuer_id=issuer.issuer_id draft_id=organisation.draft_id %}">
                Éditer
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    {# Infos générales #}
    <h3>Personnes impliquées</h3>
    <div class="form-in-3-cols">
      {# first row: responsable + dpo #}
      <div class="fr-grid-row fr-grid-row--gutters">
        <div class="fr-col-12 fr-col-md-6 fr-col-lg-4">
          <div class="shadowed with-button-box">
            <h4 class="h2">Responsable de structure</h4>

            <strong>{{ organisation.manager.get_full_name }}</strong>
            <p>{{ organisation.manager.profession }}</p>

            <a href="mailto:{{ organisation.manager.email }}">{{ organisation.manager.email }}</a>
            <a href="tel:{{ organisation.manager.phone }}">{{ organisation.manager.phone }}</a>

            <address>
              {{ organisation.manager.address }}<br/>
              {{ organisation.manager.zipcode }}<br/>
              {{ organisation.manager.city }}<br/>
            </address>

            <p>Ce responsable est aussi aidant : {{ organisation.manager.is_aidant|yesno:"Oui,Non" }}</p>
            <div class="button-box">
              <a class="button primary"
                 href="{% url 'habilitation_new_aidants' issuer_id=issuer.issuer_id draft_id=organisation.draft_id %}">Éditer</a>
            </div>
          </div>
        </div>
        {% if organisation.data_privacy_officer %}
          <div class="fr-col-12 fr-col-md-6 fr-col-lg-4">
            <div class="shadowed with-button-box">
              <h4 class="h2">Délégué à la protection des données</h4>
              <strong>{{ organisation.data_privacy_officer.get_full_name }}</strong>
              <p>{{ organisation.data_privacy_officer.profession }}</p>
              <a href="mailto:{{ organisation.data_privacy_officer.email }}">{{ organisation.data_privacy_officer.email }}</a>
              <a href="tel:{{ organisation.data_privacy_officer.phone }}">{{ organisation.data_privacy_officer.phone }}</a>
              <div class="button-box">
                <a class="button primary"
                   href="{% url 'habilitation_new_aidants' issuer_id=issuer.issuer_id draft_id=organisation.draft_id %}">
                  Éditer
                </a>
              </div>
            </div>
          </div>
        {% endif %}
      </div>
      {# 2nd row and more: aidants #}
      <div class="fr-grid-row fr-grid-row--gutters">
        {% for aidant_request in organisation.aidant_requests.all %}
          {% if not forloop.first and forloop.counter0|divisibleby:2 %}
            </div>
            <div class="fr-grid-row fr-grid-row--gutters">
          {% endif %}
          <div class="fr-col-12 fr-col-md-6 fr-col-lg-4">
            <div class="shadowed with-button-box">
              <h4 class="h2">Aidant <span class="sr-only">{{ forloop.counter }}</span></h4>

              <strong>{{ aidant_request.get_full_name }}</strong>
              <p>{{ aidant_request.profession }}</p>

              <a href="mailto:{{ aidant_request.email }}">{{ aidant_request.email }}</a>
              <a href="tel:{{ aidant_request.phone }}">{{ aidant_request.phone }}</a>
              <div class="button-box">
                <a class="button primary"
                   href="{% url 'habilitation_new_aidants' issuer_id=issuer.issuer_id draft_id=organisation.draft_id %}">
                  Éditer
                </a>
              </div>
            </div>
          </div>
        {% endfor %}
        </div>
    </div>
    {# personnes impliquées #}
    <h3>Validation de la demande</h3>
    <div class="fr-grid-row fr-grid-row--gutters">
      <div class="fr-col-12 fr-col-md-8">
        <div class="shadowed">
          <h4 class="h2">Modalités d'utilisation</h4>
          <form method="post">
            {% csrf_token %}
            {{ form.non_field_errors }}
            {% checkbox_fr_grid_row form.cgu %}
            {% checkbox_fr_grid_row form.dpo %}
            {% checkbox_fr_grid_row form.professionals_only %}
            {% checkbox_fr_grid_row form.without_elected %}
            <div class="button-box">
              <a class="button"
                 href="{% url 'habilitation_new_aidants' issuer_id=issuer.issuer_id draft_id=organisation.draft_id %}">
                Revenir à l’étape précédente
              </a>
              <button class="primary" type="submit">Soumettre la demande</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    {% include "_more-info.html" %}
  </div>{# fr-container #}
{% endblock %}
