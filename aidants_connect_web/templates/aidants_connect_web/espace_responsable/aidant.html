{% extends 'aidants_connect_web/espace_responsable/layout/main.html' %}

{% load ac_common ac_extras dsfr_tags static %}

{% block title %}{{ aidant.get_full_name }} - Aidants Connect{% endblock %}

{% block content %}
  <div class="fr-container">

    <div class="fr-grid-row flex-between" >
      <h1>{{ aidant.get_full_name }}</h1>

      <div>
        <div class="fr-btns-group fr-btns-group--inline fr-btns-group--md">
        {% if aidant.is_active and not is_aidant_referent_of_current_org %}
          <form method="post" action="{% url 'espace_responsable_aidants' %}">
            {% csrf_token %}
            <input type="hidden" name="candidate" value="{{ aidant.pk }}">
            <button type="submit" class="fr-btn fr-btn--secondary">
              Désigner comme référent
            </button>
          </form>
        {% endif %}

        {% if aidant.is_active and aidant != responsable %}
          <a href="{% url 'espace_responsable_remove_aidant_from_organisation' aidant_id=aidant.id organisation_id=organisation.id %}"
              class="fr-btn fr-btn--secondary"
              id="remove-aidant-{{ aidant.id }}-from-organisation">
          Désactiver
          </a>
        {% endif %}
        </div>
      </div>
    </div>

    {% dsfr_django_messages %}
    <div class="fr-col-12 fr-col-md-8">

    <section class="fr-mt-8v">
      <h2 class="fr-h3 fr-mb-4 fr-title-icon-left fr-icon-user-line">
        Informations
      </h2>
      <div class="fr-card">
        <div class="fr-card__body">
          <div class="fr-card__content ">
            <div class="fr-grid-row fr-grid-row--gutters">
              <div class="fr-col-12 fr-col-md-6">
                <h3 class="fr-h6">Profession</h3>
                <p class="fr-text">
                  {{ aidant.profession }}
                </p>
              </div>
              <div class="fr-col-12 fr-col-md-6">
                <h3 class="fr-h6">Adresse e-mail</h3>
                <p class="fr-text">{{ aidant.email }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
        <div class="fr-card fr-mt-2w">
          <div class="fr-card__body">
            <div class="fr-card__content">
              <h3 class="fr-h6">
                {% if organisations_count > 1 %}Organisations{% else %}Organisation{% endif %}
              </h3>
              <p class="fr-text">{{ organisations_display }}</p>
              {% if responsable.responsable_de.count > 1 %}
                <button
                  class="fr-btn fr-btn--secondary"
                  data-fr-opened="false"
                  aria-controls="modal-change-organisations-{{ aidant.id }}"
                  data-fr-js-modal-button="true"
                >
                  Modifier l'organisation
                </button>
              {% endif %}
            </div>
          </div>
        </div>
      {% include "aidants_connect_web/espace_responsable/_modale_change_aidant_organisations.html" %}
    </section>



    <section class="fr-mt-8v">
      <h2 class="fr-h3 fr-mb-4 fr-title-icon-left fr-icon-device-line">
        Moyen de connexion
      </h2>

      <div class="fr-card fr-mt-2w">
        <div class="fr-card__body">
          <div class="fr-card__content">
            <div class="fr-grid-row" id="section-otp-card">
              <h3 class="fr-h6">Carte OTP</h3>
              <div class="fr-mb-8v fr-ml-4v">
                {% if aidant.has_a_carte_totp %}
                  <span class="fr-badge fr-badge--success">ASSOCIÉ</span>
                {% else %}
                  <span class="fr-badge fr-badge--warning">INACTIF</span>
                {% endif %}
              </div>
            </div>
            {% if aidant.has_a_carte_totp %}
              <h3 class="fr-h6">Référence : <span class="fr-text--regular">{{ aidant.carte_totp.serial_number }}</span></h3>
              <a
                id="remove-totp-card-from-aidant-{{ aidant.id }}"
                href="{% url "espace_responsable_aidant_remove_card" aidant_id=aidant.id %}"
                class="fr-btn fr-btn--secondary"
              >
                Délier la carte
              </a>
            {% elif aidant.is_active %}
              <a
                id="manage-totp-cards-for-aidant-{{ aidant.id }}"
                href="{% url "espace_responsable_associate_totp" aidant_id=aidant.id %}"
                class="fr-btn fr-btn--secondary"
              >
                Associer un moyen de connexion
              </a>
            {% endif %}
          </div>
        </div>
      </div>
      <div class="fr-card fr-mt-2w">
        <div class="fr-card__body">
          <div class="fr-card__content">
            <div class="fr-grid-row" id="section-mobile-app">
              <h3 class="fr-h6">Application mobile</h3>
              <div class="fr-mb-8v fr-ml-4v">
                {% if aidant.has_otp_app %}
                  <span class="fr-badge fr-badge--success">ASSOCIÉ</span>
                {% else %}
                  <span class="fr-badge fr-badge--warning">INACTIF</span>
                {% endif %}
              </div>
            </div>
            {% if aidant.has_otp_app %}
              <a
                id="manage-totp-cards-for-aidant-{{ aidant.id }}"
                href="{% url 'espace_responsable_aidant_remove_app_otp' aidant_id=aidant.id %}"
                class="fr-btn fr-btn--secondary fr-mt-8v"
              >
                Délier l'application mobile
              </a>
            {% elif aidant.is_active %}
              <a
                id="manage-totp-cards-for-aidant-{{ aidant.id }}"
                href="{% url 'espace_responsable_aidant_add_app_otp' aidant_id=aidant.id %}"
                class="fr-btn fr-btn--secondary"
              >
                Associer une application mobile
              </a>
            {% endif %}
          </div>
        </div>
      </div>
    </section>
  </div>
{% endblock content %}
