{% load ac_common form_extras %}
<table class="table aidants-list">
  <thead>
  <tr>
    <th>Nom</th>
    <th>Email</th>
    <th>Carte(s) Aidants Connect</th>
    <th><span class="sr-only">Retirer un aidant</span></th>
  </tr>
  </thead>
  <tbody{% class_attr table_class|default:"" %}>
  {% for aidant in aidants %}
    <tr>
      <td>
        {% if aidant.pk == responsable.pk %}
          {{ aidant.get_full_name }} (Référent)
        {% else %}
          <a href="{% url 'espace_responsable_aidant' aidant_id=aidant.id %}">
            {{ aidant.get_full_name }}
          </a>
        {% endif %}
      </td>
      <td>{% mailto recipient=aidant.email %}</td>
      <td>
        {% if aidant.has_a_carte_totp %}
          <div>
            {{ aidant.number_totp_card }}
            {% if not aidant.carte_totp.totp_device.confirmed and aidant.is_active %}
              <p class="unverified-card-warning shadowed red padding-1rem">
                Attention : Le fonctionnement de cette carte n’a pas été vérifié.
                Vous devez valider la carte pour permettre à {{ aidant.get_full_name }}
                de se connecter à Aidants Connect.
              </p>
            {% endif %}
          </div>
        {% endif %}
        {% if aidant.has_otp_app %}
          <p>Une carte numérique est associée à ce profil</p>
        {% endif %}
      </td>
      <td>
        {% if aidant.pk != responsable.pk and aidant.is_active %}
          <a
            id="remove-aidant-{{ aidant.id }}-from-organisation"
            href="{% url 'espace_responsable_remove_aidant_from_organisation' aidant_id=aidant.id organisation_id=organisation.id %}"
            class="button"
          >
            {% if aidant.organisations.count > 1 %}
              Retirer l’aidant de l’organisation
            {% else %}
              Désactiver l’aidant
            {% endif %}
          </a>
        {% endif %}

        <a
          id="manage-totp-cards-for-aidant-{{ aidant.id }}"
          href="{% url "espace_responsable_choose_totp" aidant_id=aidant.id %}"
          class="button"
        >
          Gérer les cartes OTP
        </a>
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
