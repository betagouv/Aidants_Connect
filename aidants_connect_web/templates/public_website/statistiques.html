{% extends 'layouts/main.html' %}

{% load static %}

{% block title %}Aidants Connect - Statistiques{% endblock %}

{% block extracss %}
<link href="{% static 'css/dashboard.css' %}" rel="stylesheet">
{% endblock extracss %}


{% block content %}
<section class="section" id="statistics">
  <div class="container">
    <h1 class="section__title">Statistiques d’Aidants Connect</h1>
    <div class="tiles">

      <h2>Utilisation</h2>
      <div class="grid">
        <div class="tile-box stretch">
          <div class="tile tile-grey text-center">
            <h3 class="font-weight-normal">Démarches administratives réalisés</h3>
            <strong>{{ autorisation_use_count }}</strong>
          </div>
        </div>
        <div class="tile-box stretch">
          <div class="tile tile-grey text-center">
            <h3 class="font-weight-normal">Personnes accompagnées</h3>
            <strong>{{ usagers_with_mandat_count }}</strong>
          </div>
        </div>
        <div class="tile-box stretch">
          <div class="tile tile-grey text-center">
            <h3 class="font-weight-normal">Mandats crées</h3>
            <strong>{{ mandats_count }}</strong>
          </div>
        </div>
      </div>

      <br>

      <h3>Par type de démarche</h3>
      <div id="container" style="position: relative; height:40vh; width:80vw">
        <canvas id="mandats-chart" data-url="{% url 'mandats-chart' %}"></canvas>
      </div>

      <br>

      <h2>Déploiement</h2>
      <div class="grid">
        <div class="tile-box">
          <div class="tile tile-grey text-center">
            <h3 class="font-weight-normal">Aidants habilités</h3>
            <strong>{{ aidants_count }}</strong>
          </div>
        </div>
        <div class="tile-box">
          <div class="tile tile-grey text-center">
            <h3 class="font-weight-normal">Aidants en cours d’habilitation</h3>
            <strong>{{ aidants_habilitating_count }}</strong>
          </div>
        </div>
        <div class="tile-box">
          <div class="tile tile-grey text-center">
            <h3 class="font-weight-normal">Structures habilités</h3>
            <strong>{{ organisations_habilitated_count }}</strong>
          </div>
        </div>
        <div class="tile-box">
          <div class="tile tile-grey text-center">
            <h3 class="font-weight-normal">Structures en cours d’habilitation</h3>
            <strong>{{ organisations_not_habilitated_count }}</strong>
          </div>
        </div>
      </div>

    </div>
  </div>
</section>

<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<script>
    $(function () {
      var $mandatsChart = $("#mandats-chart");
      $.ajax({
        url: $mandatsChart.data("url"),
        success: function (data) {

          var ctx = $mandatsChart[0].getContext("2d");

          new Chart(ctx, {
            type: 'bar',
            data: {
              labels: data.labels,
              datasets: [{
                label: 'Nombre de démarches',
                backgroundColor: 'blue',
                data: data.data
              }]
            },
            options: {
              responsive: true,
              aspectRatio:2,
              maintainAspectRatio: true,
              legend: {
                position: 'top',
              },
              title: {
                display: true,
                text: 'Les périmètres des mandats'
              },
              scales: {
                xAxes: [{
                  gridLines: {
                      display:false
                  }
                }]
              }
            }
          });

        }
      });
    });

</script>
{% endblock content %}
